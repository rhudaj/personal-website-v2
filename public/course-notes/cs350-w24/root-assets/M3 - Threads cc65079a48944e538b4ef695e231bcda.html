<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>M3 - Threads</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	padding-inline-start: 0;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.page-description {
    margin-bottom: 2em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-uiBlue { background-color: rgba(35, 131, 226, .07); }
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-transparentGray { background-color: rgba(227, 226, 224, 0); }
.select-value-color-translucentGray { background-color: rgba(255, 255, 255, 0.0375); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(253, 236, 200, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }
.select-value-color-pageGlass { background-color: undefined; }
.select-value-color-washGlass { background-color: undefined; }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="cc65079a-4894-4e53-8b4e-f695e231bcda" class="page sans"><header><div class="page-header-icon undefined"><img class="icon" src="https://www.notion.so/icons/document_purple.svg"/></div><h1 class="page-title">M3 - Threads</h1><p class="page-description"></p></header><div class="page-body"><h3 id="0ed5c6a5-1b60-40bb-8b3e-2563548dd657" class=""><strong>Threads ‚Äî Motivation</strong></h3><ol type="1" id="9e923915-8e27-4def-8d0d-947993567f33" class="numbered-list" start="1"><li>Let‚Äôs a single process make use of multiple cores. </li></ol><ol type="1" id="b7420c51-6086-4d0d-b03e-6d3e8c6bb85a" class="numbered-list" start="2"><li>Separate processes need <em>pipes</em> to communicate with each other. This is wasteful if many seperate P‚Äôs need access to the same data. It would be good if multiple tasks could run and share/modify some of the same data<em> </em>in memory. </li></ol><hr id="3dfaab2a-08d0-401c-aedc-44f1fe569658"/><figure class="block-color-default callout" style="white-space:pre-wrap;display:flex" id="b6db9619-d87b-4a8a-b49f-5f5a9fb7461a"><div style="font-size:1.5em"><span class="icon">‚ùó</span></div><div style="width:100%"><mark class="highlight-red"><strong>Threads</strong></mark><hr id="b34e1089-8ce9-4231-b0cd-39781c183a4f"/><p id="7f9b7774-d8e8-43f7-ac43-14e60cdbc24d" class="">Threads let you do <em>multiple tasks </em>at the same time within the same <em>address space</em></p><hr id="83bdfcf3-b1a8-4e5d-bd55-b24dc5f00459"/><p id="7d21bde0-7914-4431-90db-637c9f079b50" class="">A thread is a <strong>schedulable execution context </strong></p><ul id="aef2ae06-648d-498c-9e6d-758d25e294f9" class="bulleted-list"><li style="list-style-type:disc">A process is what is scheduled. Within a process, it can set up it‚Äôs own <em>execution contexts </em>(the task within the process that is running)</li></ul><ul id="50eb9ece-b45f-4e4e-a33f-ff1da392d95a" class="bulleted-list"><li style="list-style-type:disc">This <em>context</em> considers what is specific to that task. The threads still share key parts, like an address space, but have enough seperation to run at the same time without conflict. <ul id="9e7f5015-21f8-43b9-856d-2c73356700db" class="bulleted-list"><li style="list-style-type:circle"><mark class="highlight-gray">Since the different threads share the same address space (global variables), it‚Äôs easy for them to communicate with each other.</mark></li></ul></li></ul><ul id="5774e03a-ca1c-465b-9278-957014d7a71b" class="bulleted-list"><li style="list-style-type:disc">So, while a process is an instance of a program, a thread takes care of running the program (the instructions stored within the address space of the process + registers used</li></ul><hr id="b5b0304e-de0c-49f7-83f6-ae1db931808d"/><figure id="9865eb58-22ca-4aaf-8169-9b9b8f302a3d" class="image" style="text-align:center"><a href="M3%20-%20Threads%20cc65079a48944e538b4ef695e231bcda/Screen_Shot_2024-03-04_at_15.20.18.png"><img style="width:336px" src="M3%20-%20Threads%20cc65079a48944e538b4ef695e231bcda/Screen_Shot_2024-03-04_at_15.20.18.png"/></a></figure></div></figure><figure class="block-color-default callout" style="white-space:pre-wrap;display:flex" id="b2dcc8a4-ed8d-4b8e-98f9-a614b90e314a"><div style="font-size:1.5em"><span class="icon">‚ùó</span></div><div style="width:100%"><mark class="highlight-red"><strong>Execution Context </strong></mark><hr id="690a7db0-189d-484e-a673-1d0a9255c9f2"/><p id="b42ba8e1-d126-4596-ba73-144702803e5a" class="">For multiple threads running on the same core, they each their own need a copy of: </p><table id="cacbf925-991e-4a79-830d-401125f84dc3" class="simple-table"><tbody><tr id="eb51cdbc-138d-41fc-b559-f4de28eb486c"><th id="OPOq" class="simple-table-header-color simple-table-header">Program Counter</th><td id="hhmQ" class="" style="width:363.985595703125px">Next instruction to execute.</td></tr><tr id="4e874aa7-6dc8-42ab-b716-ac32334dd86f"><th id="OPOq" class="simple-table-header-color simple-table-header">Registers</th><td id="hhmQ" class="" style="width:363.985595703125px">copy of hardware registers.</td></tr><tr id="4d93585c-5d2a-433c-a7c3-9cb0d3ebf216"><th id="OPOq" class="simple-table-header-color simple-table-header">Stack</th><td id="hhmQ" class="" style="width:363.985595703125px">local variables (i.e., the function that the thread represents)</td></tr></tbody></table><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="b3ff94e8-0089-4210-897c-43f9a251ce65"><div style="font-size:1.5em"><span class="icon">‚ùì</span></div><div style="width:100%"><strong>PCB vs. Execution Context</strong><div id="325cfc8f-daa7-4c05-aa2c-d9bd95468475" class="column-list"><div id="c4c05cb0-a3b3-4b25-957c-9f5876d66a8c" style="width:50%" class="column"><table id="2b51bbb7-e7ed-4a92-9709-53f2057b469f" class="simple-table"><thead class="simple-table-header"><tr id="78eb0c1d-389c-451b-8fe1-c12e5490ac1b"><th id="Ochu" class="simple-table-header-color simple-table-header" style="width:134.9857940673828px"></th><th id="tgo^" class="simple-table-header-color simple-table-header" style="width:47.98579406738281px">PCB</th><th id="l}:N" class="simple-table-header-color simple-table-header" style="width:44.99431610107422px">EC</th></tr></thead><tbody><tr id="21bddff3-2374-4228-95fc-6966122905ad"><th id="Ochu" class="simple-table-header-color simple-table-header" style="width:134.9857940673828px">State </th><td id="tgo^" class="" style="width:47.98579406738281px">X</td><td id="l}:N" class="" style="width:44.99431610107422px"></td></tr><tr id="5dc8d240-b3ce-463f-bdaa-6cad143838a3"><th id="Ochu" class="simple-table-header-color simple-table-header" style="width:134.9857940673828px">PID</th><td id="tgo^" class="" style="width:47.98579406738281px">X</td><td id="l}:N" class="" style="width:44.99431610107422px"></td></tr><tr id="e8ed76da-a602-49bb-aedf-1b2473dfe842"><th id="Ochu" class="simple-table-header-color simple-table-header" style="width:134.9857940673828px">User ID</th><td id="tgo^" class="" style="width:47.98579406738281px">X</td><td id="l}:N" class="" style="width:44.99431610107422px"></td></tr><tr id="d81e7186-e83e-459b-ba8a-eb905724e5fc"><th id="Ochu" class="block-color-yellow_background simple-table-header" style="width:134.9857940673828px">PC</th><td id="tgo^" class="block-color-yellow_background" style="width:47.98579406738281px">X</td><td id="l}:N" class="block-color-yellow_background" style="width:44.99431610107422px">X</td></tr><tr id="488dfef3-d280-4149-a537-d222b7d2fe87"><th id="Ochu" class="block-color-yellow_background simple-table-header" style="width:134.9857940673828px">Registers</th><td id="tgo^" class="block-color-yellow_background" style="width:47.98579406738281px">X</td><td id="l}:N" class="block-color-yellow_background" style="width:44.99431610107422px">X</td></tr><tr id="31dd0795-c623-4788-8ce2-8ee070e2ffc4"><th id="Ochu" class="simple-table-header-color simple-table-header" style="width:134.9857940673828px">Address-Space </th><td id="tgo^" class="" style="width:47.98579406738281px">X</td><td id="l}:N" class="" style="width:44.99431610107422px"></td></tr><tr id="9952b5f5-69a1-4254-aa51-946814c5a451"><th id="Ochu" class="simple-table-header-color simple-table-header" style="width:134.9857940673828px">Open Files</th><td id="tgo^" class="" style="width:47.98579406738281px">X</td><td id="l}:N" class="" style="width:44.99431610107422px"></td></tr></tbody></table><p id="31153d3b-ec46-49c5-b83c-442b039bc267" class="">
</p></div><div id="037cc1fb-38c5-4e25-b490-8407a73c3435" style="width:50%" class="column"><p id="b52e85c6-9d8b-4b81-b5e3-49eca1489be4" class="">Address Space</p><table id="27b5f1ed-14ef-4f9b-809a-d8e20345077e" class="simple-table"><tbody><tr id="b78576a6-4a11-4c88-82af-1ff894e97d94"><th id="Vo\C" class="simple-table-header-color simple-table-header" style="width:35px">n</th><td id="a;qM" class="" style="width:80.99431610107422px">Stack 0</td><td id="rxue" class="">Thread 1</td></tr><tr id="3ebec029-dd2a-4ce3-8761-ad2db865ffda"><th id="Vo\C" class="simple-table-header-color simple-table-header" style="width:35px"></th><td id="a;qM" class="" style="width:80.99431610107422px">Stack 1</td><td id="rxue" class="">Thread 2</td></tr><tr id="1766615b-ccb1-43b4-87f1-95e6b7021775"><th id="Vo\C" class="simple-table-header-color simple-table-header" style="width:35px"></th><td id="a;qM" class="" style="width:80.99431610107422px">Stack 2</td><td id="rxue" class="">Thread 3</td></tr><tr id="2f9e2b58-ff92-4c48-a289-56ce4b071e43"><th id="Vo\C" class="simple-table-header-color simple-table-header" style="width:35px">‚Ä¶</th><td id="a;qM" class="" style="width:80.99431610107422px">‚Ä¶</td><td id="rxue" class="">‚Ä¶</td></tr><tr id="134551e7-8a51-4a33-9ad6-6cfd4a9ae931"><th id="Vo\C" class="simple-table-header-color simple-table-header" style="width:35px"></th><td id="a;qM" class="" style="width:80.99431610107422px">heap</td><td id="rxue" class="">dynamic var‚Äôs</td></tr><tr id="a69b4ee8-8439-41db-b1b5-8d72fc7c8cd9"><th id="Vo\C" class="simple-table-header-color simple-table-header" style="width:35px"></th><td id="a;qM" class="" style="width:80.99431610107422px">data</td><td id="rxue" class="">global var‚Äôs</td></tr><tr id="2056f25a-6141-4b93-a7a5-5d82c22f063e"><th id="Vo\C" class="simple-table-header-color simple-table-header" style="width:35px">0</th><td id="a;qM" class="" style="width:80.99431610107422px">code</td><td id="rxue" class="">program code</td></tr></tbody></table><p id="4286819a-9da0-453c-809a-0c3ebaf0b6d6" class="">Share globals/heap. </p><p id="553084a7-13e8-4975-8b32-0bbd716372d4" class="">Own stack. </p></div></div></div></figure></div></figure><h3 id="36bbc592-f0d0-4ff7-b1be-e1ad8ed9bc78" class="">Benefits of Threads</h3><ol type="1" id="00d0a2a5-4f60-4a67-99e2-85d24e2a3a0b" class="numbered-list" start="1"><li>Allows 1 process to use multiple cores</li></ol><ol type="1" id="8eb3dc82-84b6-4d5a-9a45-f5da8fd3cd7a" class="numbered-list" start="2"><li>Faster than setting up a new process (less context to save)</li></ol><ol type="1" id="f2d74a28-857d-451c-bd77-280ae072e241" class="numbered-list" start="3"><li>A program can do I/O and computation at the same time. </li></ol><ol type="1" id="463352a6-4204-4389-bf09-e2e6d783f736" class="numbered-list" start="4"><li>Special apps can run on a kernel thread and don‚Äôt need to<em> transfer control</em> to do <em>syscall</em>‚Äôs</li></ol><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="6db6c726-17e7-4919-9795-f35e36450c59"><div style="font-size:1.5em"><span class="icon">üí°</span></div><div style="width:100%"><strong><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span></span><span>Ôªø</span></span></strong><strong> threads vs </strong><strong><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span></span><span>Ôªø</span></span></strong><strong> processes</strong><hr id="f705737a-5a94-4d79-bedf-43222d92c690"/><p id="ef61d2dd-cbd8-4971-8159-1d7593aaadf1" class="">Both let you do tasks concurrently</p><hr id="aa82daeb-80d9-41e3-89ac-d52ff467d2e5"/><p id="aed0b401-9b01-4d6c-8222-d920e00d082b" class="">Threads are better when you need to share data lots of data between 2 tasks.</p><p id="48f9cddd-54c3-4cf6-90ca-68dbd352f067" class="">If your doing all standalone things, it will be the same wether you use process or threads. </p><p id="ee2f5f5f-a793-45b9-a76a-2e829d961b62" class="">Process abstraction gives you very nice isolation, but this comes with overhead (separate address spaces). </p><hr id="c4f1642a-4bbf-4281-9e3a-1b558292171a"/><p id="7fa7695f-aeec-4c1f-9eca-e3ed189efebf" class="">Context switching between threads over the same process is faster. We are in the same address space. Only need to change the <em>execution context. </em></p><p id="9be7738d-b869-4575-99f4-a78e073a3775" class="">Context switching between threads over separate processes is slower. Need to also <strong>flush the TLB. </strong></p></div></figure><details open=""><summary style="font-weight:600;font-size:1.5em;line-height:1.3;margin:0">POSIX - Thread API</summary><div class="indented"><p id="0df0661d-c8cb-4700-a84a-16dd813fbc03" class=""><strong>Summary: </strong></p><div><table id="f6ab1998-81c5-4002-9041-6bc77d2932fa" class="simple-table"><thead class="simple-table-header"><tr id="148ad427-cecc-4297-afc7-98a34b2515bc"><th id="^CvD" class="simple-table-header-color simple-table-header" style="width:237px"><strong><mark class="highlight-default"><code>pthread_</code></mark></strong></th><th id="b:&gt;Q" class="simple-table-header-color simple-table-header" style="width:264px">?</th><th id="c{;T" class="simple-table-header-color simple-table-header"><strong>returns</strong></th></tr></thead><tbody><tr id="915f2193-2e68-4bb7-9895-705c255eb7aa"><th id="^CvD" class="simple-table-header-color simple-table-header" style="width:237px"><strong><code><mark class="highlight-default">int create(*thr, *fn, *args)</mark></code></strong></th><td id="b:&gt;Q" class="" style="width:264px">create a new thread <mark class="highlight-default"><code>thr</code></mark> to run <mark class="highlight-default"><code>fn</code></mark><mark class="highlight-default"> with </mark><code><mark class="highlight-default">args</mark></code></td><td id="c{;T" class="">error/success</td></tr><tr id="595f5da3-2f17-4e38-bdb3-64cfb1af4f6f"><th id="^CvD" class="simple-table-header-color simple-table-header" style="width:237px"><strong><mark class="highlight-default"><code>void exit(*return_val)</code></mark></strong></th><td id="b:&gt;Q" class="" style="width:264px"><em>Terminate</em>, give <mark class="highlight-default"><code>return_val</code></mark> address to parent when they call <em>join()</em></td><td id="c{;T" class=""></td></tr><tr id="d55bc1f6-acc6-4007-aa3c-2eede7fb4b0e"><th id="^CvD" class="simple-table-header-color simple-table-header" style="width:237px"><strong><mark class="highlight-default"><code>int join(thr, *return_val)</code></mark></strong></th><td id="b:&gt;Q" class="" style="width:264px">Block until child thread <mark class="highlight-default"><code>thr</code></mark> terminates. Get the <mark class="highlight-default"><code>return_val</code></mark></td><td id="c{;T" class="">error/success</td></tr><tr id="00fbd44c-ed77-4a8e-880a-237ecc1c0ee0"><th id="^CvD" class="simple-table-header-color simple-table-header" style="width:237px"><strong><mark class="highlight-default"><code>void pthread_yield()</code></mark></strong></th><td id="b:&gt;Q" class="" style="width:264px">Set yourself as <em>ready</em> state from <em>run</em></td><td id="c{;T" class=""></td></tr><tr id="a766bfb7-4c45-4101-8cfc-3903051bd5f8"><th id="^CvD" class="simple-table-header-color simple-table-header" style="width:237px"></th><td id="b:&gt;Q" class="" style="width:264px"></td><td id="c{;T" class=""></td></tr></tbody></table></div><p id="d380aad0-9465-4de1-b37a-c5dd4e360195" class=""><em>syscall</em>‚Äôs for creating processes (ie: done in kernel-space)</p><figure class="block-color-default callout" style="white-space:pre-wrap;display:flex" id="d8414841-2146-46e3-aaff-82e713321e78"><div style="font-size:1.5em"><img class="icon" src="https://www.notion.so/icons/code_gray.svg"/></div><div style="width:100%"><mark class="highlight-default"><code><strong>int pthread_create</strong></code></mark><hr id="fe33229a-96d3-47de-bd15-1187115e5691"/><p id="4d014120-3605-4001-b4bf-011956856929" class="">create a new thread</p><hr id="5df13fe8-2b2f-4daa-98b8-48ed0de716a6"/><table id="0eb03363-febd-4169-97ba-e0e3e6e7a134" class="simple-table"><thead class="simple-table-header"><tr id="2619c598-59c2-4174-b09f-5840d3d07fcf"><th id="bNjG" class="simple-table-header-color simple-table-header">Parameter</th><th id="]:QD" class="simple-table-header-color simple-table-header" style="width:411.9783630371094px">?</th></tr></thead><tbody><tr id="cb11ba49-5862-4e2c-a7db-0284ea51a198"><th id="bNjG" class="simple-table-header-color simple-table-header"><mark class="highlight-default"><code>pthread_t * thr</code></mark></th><td id="]:QD" class="" style="width:411.9783630371094px">pointer where the <em>unique id </em>of this new thread will be stored</td></tr><tr id="e711322e-0000-4b4f-a315-504699582005"><th id="bNjG" class="simple-table-header-color simple-table-header"><mark class="highlight-default"><code>void *(*fn)(void *)</code></mark></th><td id="]:QD" class="" style="width:411.9783630371094px">function to run</td></tr><tr id="0b516bfd-0aa4-4dc0-87b8-32bc316c7ad1"><th id="bNjG" class="simple-table-header-color simple-table-header"><mark class="highlight-default"><code>void *arg</code></mark></th><td id="]:QD" class="" style="width:411.9783630371094px">arguments for <mark class="highlight-default"><code>fn</code></mark></td></tr></tbody></table><hr id="3cb031cd-10e3-43b0-8f1c-dcfee229f2ca"/><p id="47fee61d-83e6-4411-8410-1c709d02a606" class=""><strong>Returns </strong>&lt;int&gt;</p></div></figure><figure class="block-color-default callout" style="white-space:pre-wrap;display:flex" id="25103787-470c-4026-8e42-0a94b150b902"><div style="font-size:1.5em"><img class="icon" src="https://www.notion.so/icons/code_gray.svg"/></div><div style="width:100%"><mark class="highlight-default"><code><strong>void pthread_exit</strong></code></mark><hr id="ef65a4ac-6951-4d4a-992f-3cd8c5541dbe"/><p id="6e5a039e-4335-47f7-9961-3b4266267aa8" class="">Destroy the current thread, set the value of the return code. </p><hr id="8382cc81-5641-480e-883b-53127575b6de"/><table id="18813a49-489d-4007-9dc9-3ed35fd16861" class="simple-table"><thead class="simple-table-header"><tr id="29433f21-6791-41c1-a065-11f92a7e7e9f"><th id="bNjG" class="simple-table-header-color simple-table-header">Parameter</th><th id="]:QD" class="simple-table-header-color simple-table-header" style="width:375.9831848144531px">?</th></tr></thead><tbody><tr id="dfa72c55-09fe-4273-bbf6-a0549d5d53d3"><th id="bNjG" class="simple-table-header-color simple-table-header"><mark class="highlight-default"><code>void * return_value</code></mark></th><td id="]:QD" class="" style="width:375.9831848144531px">Pointer to a return code. <br/>Given to the parent thread when the parent thread calls <br/><mark class="highlight-default"><code>pthread_join()</code></mark></td></tr></tbody></table></div></figure><figure class="block-color-default callout" style="white-space:pre-wrap;display:flex" id="48450f08-c2a2-452d-9ab4-354844d3a12b"><div style="font-size:1.5em"><img class="icon" src="https://www.notion.so/icons/code_gray.svg"/></div><div style="width:100%"><mark class="highlight-default"><code><strong>int pthread_join</strong></code></mark><hr id="64a248f3-e8f7-42ee-b237-7dc554131471"/><p id="635aadcd-0379-4076-82f7-27f23c3ac46e" class="">Block until child thread to exit. Get the return_value. </p><hr id="71bed345-87b9-4977-96b2-60598f62a909"/><table id="522b722f-ffdf-44e6-b26c-21e828751698" class="simple-table"><thead class="simple-table-header"><tr id="8b36b08c-37f3-4f79-9a10-222cd9d24d6e"><th id="bNjG" class="simple-table-header-color simple-table-header">Parameter</th><th id="]:QD" class="simple-table-header-color simple-table-header" style="width:288.98797607421875px">?</th></tr></thead><tbody><tr id="30fe974f-f5b4-4f3a-bdfa-875ca4e74ebb"><th id="bNjG" class="simple-table-header-color simple-table-header"><mark class="highlight-default"><code>pthread_t thread</code></mark></th><td id="]:QD" class="" style="width:288.98797607421875px">thread to wait for.</td></tr><tr id="9d14ed1e-8e01-4ba0-ac67-726b06734724"><th id="bNjG" class="simple-table-header-color simple-table-header"><mark class="highlight-default"><code>void ** return_value</code></mark></th><td id="]:QD" class="" style="width:288.98797607421875px">return value from the thread which exits. </td></tr></tbody></table></div></figure><figure class="block-color-default callout" style="white-space:pre-wrap;display:flex" id="43e06d21-d04c-4f25-9d04-8af6e7246bce"><div style="font-size:1.5em"><img class="icon" src="https://www.notion.so/icons/code_gray.svg"/></div><div style="width:100%"><mark class="highlight-default"><code><strong>void pthread_yield()</strong></code></mark><hr id="6a2b5b8c-6525-4891-8024-60c542ab2f24"/><p id="62f99cff-18fc-4bd9-a4c6-953e22a11dbe" class="">Set yourself as <em>ready</em> state (so another can <em>run</em>) </p></div></figure><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3;margin:0"><mark class="highlight-purple"><strong>Example</strong></mark></summary><div class="indented"><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="fcbf8a6b-395f-4a8c-9d49-8ce4b9089a30" class="code"><code class="language-C">// Signature of Function to run on thread(s)
void * print_message( void *ptr );

main() {
   pthread_t thread1, thread2;
   char *message1 = &quot;Thread 1&quot;; //
   char *message2 = &quot;Thread 2&quot;;
   int  iret1, iret2; //return values of the threads

  /* Create 2 threads */

   iret1 = pthread_create(&amp;thread1, NULL, print_message, (void*) message1);
   iret2 = pthread_create(&amp;thread2, NULL, print_message, (void*) message2);

   /* Wait until threads are complete before main continues. Unless we
		  wait we run the risk of executing an exit which will terminate
		  the process and all threads before the threads have completed. */

   pthread_join(thread1, NULL);
   pthread_join(thread2, NULL); 

   printf(&quot;Thread 1 returns: %d\n&quot;, iret1);
   printf(&quot;Thread 2 returns: %d\n&quot;, iret2);

   exit(0);
}

void *print_message(void * ptr) {
     char *message;
     message = (char *) ptr;
     printf(&quot;%s \n&quot;, message);
}</code></pre><p id="9f72ce41-858b-40a7-b263-2f498fc2b1ed" class="">output: </p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="4e7076d8-5301-4c07-810f-33de0bb33773" class="code"><code class="language-Plain Text">Thread 1
Thread 2
Thread 1 returns: 0
Thread 2 returns: 0</code></pre><p id="89b67896-4b23-411b-9c01-92faab067da4" class="">
</p></div></details></div></details><hr id="f59d2736-ce3f-4f2f-804c-c94b0bfa3819"/><figure class="block-color-default callout" style="white-space:pre-wrap;display:flex" id="5046a2c7-e666-4674-9ea3-eb85e6399b24"><div style="font-size:1.5em"><span class="icon">‚ùó</span></div><div style="width:100%"><mark class="highlight-red"><strong>Kernel Threads</strong></mark><hr id="71cc49bf-919c-4b63-80de-a29daf932a25"/><ul id="745a2621-6b11-4097-8f29-b9df5e2b0904" class="bulleted-list"><li style="list-style-type:disc">Threads created &amp; scheduled by the Kernel. Given a core (scheduled) by the Kernel. The context is stored within the kernel.</li></ul><ul id="3151efeb-72c2-40d1-bb5c-6fb6088de972" class="bulleted-list"><li style="list-style-type:disc">The Kernel schedules threads within processes; A process it 1 thread at first </li></ul><ul id="3637a132-5210-42a3-b628-efa31bfb3fa8" class="bulleted-list"><li style="list-style-type:disc">By default, every process has 1 (kernel) thread at first. </li></ul></div></figure><figure class="block-color-default callout" style="white-space:pre-wrap;display:flex" id="de1df2ae-6977-4ea6-9bfb-7ed8335c2f27"><div style="font-size:1.5em"><span class="icon">‚ùó</span></div><div style="width:100%"><mark class="highlight-red"><strong>User Threads</strong></mark><hr id="9e6e6333-3363-4546-8774-c2c9d58d8fd8"/><ul id="5d729e4f-a9f7-4e8f-bd57-ba33f32e203a" class="bulleted-list"><li style="list-style-type:disc">Created by a <strong>user-space threading library (USTL)</strong>, but they run on a kernel thread. </li></ul><ul id="07e0b70d-52cd-4f83-a385-f5be23087c9b" class="bulleted-list"><li style="list-style-type:disc">when the kernel thread is run in user space, what it runs is determine by a USTL<ul id="a01e0e69-1aa2-47e7-ab7d-6683d1ef4ae9" class="bulleted-list"><li style="list-style-type:circle">The <em>USTL</em> can change the context (create a user-space thread), allowing it to run some other code, unaware to the <em>Kernel</em>. </li></ul><ul id="f0dceb28-f1f3-4b29-89d2-a84a32316a68" class="bulleted-list"><li style="list-style-type:circle">Schedules the UT‚Äôs to the KT that has been assigned to this process</li></ul></li></ul><hr id="9c1b0577-ef32-4491-9b09-2a6a2acd5bac"/><p id="6dba3156-9069-4938-bfd9-1a74c410011a" class="">All of this happens without any syscall‚Äôs: </p><p id="6129fde8-e461-4da9-849b-581d7d05b6e7" class=""><code>pthread_create</code> is now a<em> user-space</em> function: </p><ul id="5cea2218-15cb-494b-8349-daaedf18d6a9" class="bulleted-list"><li style="list-style-type:disc">creates the execution context in user-space (ie: allocate new stack)</li></ul><ul id="5e57779d-c792-4cad-b458-8febe845202a" class="bulleted-list"><li style="list-style-type:disc">The KT runs based on the <strong><em>PC</em></strong> &amp; <strong><em>stack-pointer </em></strong>whcih the USTL changes behind the scenes.</li></ul><ul id="7282a9d0-1c22-4eff-8a49-a7e93ce16c02" class="bulleted-list"><li style="list-style-type:disc">When a context switch happens, you save the context for the current user-thread to it‚Äôs own frame in memory.</li></ul><p id="d92511de-9885-4091-b02f-3f998f426e0b" class=""><code>pthread_yield</code> is also a library-call in user-space</p><ul id="990a7141-abed-42e1-be6b-2cd4175f27f9" class="bulleted-list"><li style="list-style-type:disc">switches the active thread, changing the execution context </li></ul><ul id="33e84dc8-0883-4540-b1fb-3500666c43ff" class="bulleted-list"><li style="list-style-type:disc">saves old one in user-space </li></ul></div></figure><h1 id="4dd2aebf-450a-49a9-8d67-49d7a18d2075" class=""><mark class="highlight-red">Models</mark></h1><h2 id="48a2b827-7aac-4804-93de-96ebc0f144d8" class=""><mark class="highlight-orange">Only Kernel Threads</mark></h2><p id="4331b8f5-c9aa-4bc5-9865-e3c7e6f3b7ff" class=""><strong>Limitations</strong></p><ul id="0627bf05-486f-48ce-9328-4d9be8a5a283" class="bulleted-list"><li style="list-style-type:disc"><strong>slow:</strong> every thread operation is done in the kernel (lots of <em>syscall</em>‚Äôs)</li></ul><ul id="1ba82790-511f-4daa-a3b9-c09be3a02184" class="bulleted-list"><li style="list-style-type:disc"><strong>memory cost: </strong>requires a stack within the kernel and within user-space (<strong>TLB</strong>)</li></ul><h2 id="74587141-d3d1-4f3e-9ae5-3563cdaa7900" class=""><mark class="highlight-orange"><strong>1 kernel-thread, </strong></mark><mark class="highlight-orange"><strong><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span></span><span>Ôªø</span></span></strong></mark><mark class="highlight-orange"><strong> user-thread‚Äôs</strong></mark></h2><figure id="e762d710-ff04-4c9e-98ef-5f867150ba21" class="image" style="text-align:center"><a href="M3%20-%20Threads%20cc65079a48944e538b4ef695e231bcda/Screen_Shot_2024-02-27_at_18.36.21.png"><img style="width:240px" src="M3%20-%20Threads%20cc65079a48944e538b4ef695e231bcda/Screen_Shot_2024-02-27_at_18.36.21.png"/></a></figure><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="6a8376ba-d835-47b0-9cee-2abaa4c3bc83"><div style="font-size:1.5em"><span class="icon">üí°</span></div><div style="width:100%"><strong>Your not doing more at once. But you can do more in a given time. </strong><ul id="2e6c0847-0144-4c86-a4a1-d1bef5781b23" class="bulleted-list"><li style="list-style-type:disc">Each kernel thread uses only 1 core. </li></ul><ul id="53124c77-90ff-42b3-ae2a-6c6f7674dbc9" class="bulleted-list"><li style="list-style-type:disc">Only kernel threads are scheduled. The OS does not know about user-threads. Only 1 user-level thread can run at a time. Only sees the kernel threads it created. </li></ul><ul id="974a3bd8-419d-4dfa-b49a-4e1fc28d9950" class="bulleted-list"><li style="list-style-type:disc">With User threads, your still only running 1 instruction at a time, on the same kernel thread. </li></ul><ul id="98856723-b5c0-4bb2-8e97-31a52146c20e" class="bulleted-list"><li style="list-style-type:disc">But while one user-thread is waiting on input/data, another can start running. </li></ul></div></figure><ul id="9420ba2d-49b5-43df-8af4-c4bab791eb10" class="toggle"><li><details open=""><summary><strong>Implementation</strong></summary><ol type="1" id="0bcdf0cf-2ef6-4d3e-b5df-af549b656477" class="numbered-list" start="1"><li>User space library holds a <strong>queue</strong> of user-threads. It decides how to schedule them. </li></ol><ol type="1" id="a8dff2e5-e908-4863-9081-a7b3eee6280c" class="numbered-list" start="2"><li>Replace <strong>blocking </strong><em><strong>syscall</strong></em><strong>‚Äôs</strong><p id="a5d8b324-c506-466a-afe4-8324e6a90692" class=""><strong>blocking syscall</strong></p><p id="d3aebaf8-9c47-49b2-aa59-3b9abfa1c1b6" class="">e.g: read, write</p><p id="05ffdd7f-8c5e-4340-96e8-77e420c0e57d" class="">Blocks the KT until data is available ‚áí KT ‚Üí wait state ‚áí no UT can run</p><p id="85278b7d-b129-4185-8b68-05e8d1d3b56e" class=""><strong>Non-Blocking syscall</strong></p><ul id="0f66db5c-7d32-4f7b-a4b1-93393908dc91" class="bulleted-list"><li style="list-style-type:disc">If file/data is not available, return nothing</li></ul><ul id="d674a524-dab2-46fa-8415-f9fff00d2dbb" class="bulleted-list"><li style="list-style-type:disc">It‚Äôs up to the user-space to switch the <em>running </em>thread.</li></ul></li></ol><ol type="1" id="65fbde7f-826e-4e9f-8012-91c4cd541cbf" class="numbered-list" start="3"><li>Schedule <strong>periodic timer signal</strong>: <code>setitimer</code><ul id="3b47bf62-acb8-4c0a-b733-e3509e5cb720" class="bulleted-list"><li style="list-style-type:disc">When the timer fires, kernel switches the user-thread. </li></ul></li></ol></details></li></ul><p id="f0f50e21-9187-4ff6-8cf4-b2e1ee843f20" class=""><strong>Limitations</strong></p><ul id="88e0c8a0-146d-43db-b00a-612a64188cfe" class="bulleted-list"><li style="list-style-type:disc">many user threads for only 1 core</li></ul><ul id="04f4a000-cbba-4898-8847-611fd80cef84" class="bulleted-list"><li style="list-style-type:disc">Blocking <em>syscall</em> can block all threads</li></ul><ul id="ba2b7426-9b18-490b-931e-7be6cf90e628" class="bulleted-list"><li style="list-style-type:disc">Page fault blocks all threads<ul id="e4e47d99-90a5-4be8-a133-45e6c610d53e" class="bulleted-list"><li style="list-style-type:circle">ie: touching memory that the kernel needs to fetch from disk ‚áí blocking syscall</li></ul></li></ul><ul id="b382eb77-646d-4eb0-949d-d690a1052549" class="bulleted-list"><li style="list-style-type:disc"><strong>Deadlock </strong>can happen easily</li></ul><h2 id="cf410009-7377-45dc-9fd0-3642ad26bf7f" class="block-color-orange"><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span></span><span>Ôªø</span></span> user-threads, <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span></span><span>Ôªø</span></span> kernel-threads</h2><figure id="dba4b30e-8ff9-470e-a8af-64422fa36c8d" class="image"><a href="M3%20-%20Threads%20cc65079a48944e538b4ef695e231bcda/Screen_Shot_2024-02-27_at_21.41.56.png"><img style="width:240px" src="M3%20-%20Threads%20cc65079a48944e538b4ef695e231bcda/Screen_Shot_2024-02-27_at_21.41.56.png"/></a></figure><hr id="e54255f4-cd21-4420-9ae6-03d8798c766e"/><ul id="2ef569d3-ee23-4094-86de-5a9145b1706d" class="bulleted-list"><li style="list-style-type:disc">A blocking operations won‚Äôt block all UT‚Äôs at once.<ul id="347c129d-594f-46df-937f-c4bcd827e198" class="bulleted-list"><li style="list-style-type:circle">Ideally want at least 1 KT per core</li></ul></li></ul><ul id="7f23e24f-85b0-4196-b466-f5354a43ec11" class="bulleted-list"><li style="list-style-type:disc">Threads are created &amp; scheduled by the USTL. <ul id="3a4a7f98-34a2-470c-b303-42a277e5b6b1" class="bulleted-list"><li style="list-style-type:circle"><code>thread_create</code>, <code>thread_exit</code> still library functions</li></ul><ul id="22291d90-4674-477e-8d9b-9ab76988a81c" class="bulleted-list"><li style="list-style-type:circle">Determines which UT runs on which KT</li></ul></li></ul><p id="a1ad792d-368c-427a-b4a4-56442ea54f80" class=""><strong>Benifits</strong></p><ul id="8c596960-5c5d-4f9f-973c-e4b91c290f46" class="bulleted-list"><li style="list-style-type:disc">Harder to block all user-level threads at once</li></ul><ul id="75755bff-13ba-4cae-80ab-74482f884693" class="bulleted-list"><li style="list-style-type:disc">deadlocks are less likely (takes more user level threads making blocking syscall‚Äôs) </li></ul><p id="a33e6f33-c5bf-4ee6-8981-cc3ff6937669" class=""><strong>Limitations </strong></p><ul id="792104fb-bc77-47d3-b38a-6bd433589551" class="bulleted-list"><li style="list-style-type:disc">Interaction between kernel and user space: <ul id="068f0fe3-87e8-4a17-a6b7-cd1cbacc34d8" class="bulleted-list"><li style="list-style-type:circle">ULTL does not know how many KT‚Äôs are available (some could be blocked)</li></ul><ul id="4e17a191-ab13-45ae-a806-cf420d5434f9" class="bulleted-list"><li style="list-style-type:circle">Kernel does not how importance of UT‚Äôs (preemption might cause huge delay)</li></ul></li></ul><hr id="f10b9c60-0a41-46f5-89ff-0a54a3ec1e85"/><h1 id="4f499959-1fdd-414c-95cf-bb782d6962bf" class="">Summary</h1><ul id="c1983b0f-7d4c-427d-bc42-1957bb87fb63" class="bulleted-list"><li style="list-style-type:disc">Threads are best implemented as a library </li></ul><ul id="8c47a0a3-13f8-4099-96be-f380d86d4005" class="bulleted-list"><li style="list-style-type:disc">Use KT‚Äôs if I/O concurrency is your main goal (lot‚Äôs of blocking calls)</li></ul><ul id="ca372324-a400-4c5d-8799-a3cca59c9659" class="bulleted-list"><li style="list-style-type:disc">Use <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>:</mo><mi>m</mi></mrow><annotation encoding="application/x-tex">n:m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span></span><span>Ôªø</span></span> threading for highly concurrent with many thread switches </li></ul><ul id="9e3ca552-b608-434c-a54b-fe2970bf25bd" class="bulleted-list"><li style="list-style-type:disc">Threads introduce problems regarding <strong>concurrency</strong>/<strong>synchronization</strong> </li></ul><p id="0d518f99-feb3-4b43-b9a4-cc74f1790d64" class="">
</p><p id="2c5237b1-2a36-4537-b5ff-976d99a3090a" class="">
</p><p id="fe2bdc87-2db6-4f2b-88d1-0b83c0d2d3bb" class="">
</p><p id="5bb6279b-340d-4a4b-9b95-381419ce6300" class="">
</p></div></article><span class="sans" style="font-size:14px;padding-top:2em"></span></body></html>